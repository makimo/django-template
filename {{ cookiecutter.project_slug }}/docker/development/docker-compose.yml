version: "3.7"

networks:
    {{ cookiecutter.project_slug }}:

services:
    {{ cookiecutter.project_slug }}-db:
        image: postgres:12-alpine
        environment:
            POSTGRES_PASSWORD: secret
            POSTGRES_USER: {{ cookiecutter.project_slug }}
            POSTGRES_DB: {{ cookiecutter.project_slug }}
        volumes:
            - "./{{ cookiecutter.project_slug }}-db:/var/lib/postgresql/data"
        networks:
            - {{ cookiecutter.project_slug }}

    {{ cookiecutter.project_slug }}-backend:
        build:
            context: ../..
            dockerfile: docker/development/Dockerfile
        volumes:
            - "../..:/app"
            - "{{ cookiecutter.project_slug }}-node_modules:/app/node_modules"
        ports:
            - "8000:8000"
        networks:
            - {{ cookiecutter.project_slug }}
        depends_on:
            - {{ cookiecutter.project_slug }}-db
        command: "/app/tools/run-development.sh"
        environment:
            {{ cookiecutter.project_slug_upper }}_DB_NAME: {{ cookiecutter.project_slug }}
            {{ cookiecutter.project_slug_upper }}_DB_USER: {{ cookiecutter.project_slug }}
            {{ cookiecutter.project_slug_upper }}_DB_PASSWORD: secret
            {{ cookiecutter.project_slug_upper }}_DB_HOST: {{ cookiecutter.project_slug }}-db
            {{ cookiecutter.project_slug_upper }}_DB_PORT: 5432

volumes:
    {{ cookiecutter.project_slug }}-db:
    {{ cookiecutter.project_slug }}-node_modules:
